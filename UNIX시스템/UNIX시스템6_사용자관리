학습개요
리눅스 시스템에서 관리자 계정과 일반 사용자 계정의 차이를 이해하고, 사용자 계정과 그룹 계정의 생성과 관리에 사용되는 명령 및 관련 파일에 관해 알아본다. ‘패스워드 에이징’의 의미를 학습하고 비밀번호 관리에 사용되는 명령과 파일을 살펴본다.

학습목표
사용자 계정의 관리에 사용되는 파일을 나열하고 용도를 설명할 있다.
사용자 계정을 생성, 삭제 및 변경할 수 있다.
사용자 계정의 ‘패스워드 에이징’ 정보를 설명할 수 있다.
그룹 계정을 생성, 삭제 및 변경할 수 있다.

정리
su 명령을 사용하여 다른 사용자 계정으로 전환할 수 있다.
sudo를 사용한 명령의 실행은 /etc/sudoers 파일에 기록된 권한 설정에 근거한다.
사용자 계정을 생성할 때 필요한 기본 설정은 /etc/login.defs 파일과 /etc/default/useradd 파일에 정의되어 있다.
관리자가 사용자 계정의 ‘패스워드 에이징’ 정보를 변경할 때 chage, useradd, usermod, passwd 명령 등을 사용할 수 있다.
사용자 계정은 1개의 주 그룹과 0개 이상의 부 그룹에 속해 있으며, 소속된 그룹에 부여된 권한을 가진다.

1. 사용자 계정
 사용자 계정이 있어야 시스템 사용 가능
 다중 사용자가 시스템 사용 가능
 - 리눅스는 다중 사용자를 지원하는 운영체제
 - 사용자명 또는 로그인아이디라고함
 - 사용자계정은 유일한 UID를 가짐 숫자

 관리자 입장에서 사용자 계정 별로 접근 권한 통제 가능
 - 사용자 계정에 따라 부여된 권한이 다름
 - 일반 사용자 계정은 자신의 홈 디렉터리를 제외하면 제한된 권한을 가짐
 - 일반 사용자 계정 외에 root계정 (UID = 0), 시스템 계정도 있음

 su 명령
 - 사용자를 전환시키는 명령
 - su[-[|]][username]
  su -| 사용자명 또는 su - 사용자명 또는 su --login 사용자명 은 지정된 사용자의 로그인 셸 시작
  root사용자가 아니라면 지정된 사용자의 암호 알아야 함
  su 사용자명은 단순이 사용자만 바뀌며, 사용자 환경과 작업디렉터리 ㅇ지
  su 또는 su-|과 같이 사용자가 생략되면 root사용자로 전환함
 - 1개의 셸 명령을 root계정으로 실행하는 명령
  su -c 'command'
  root암호를 알아야 함
  여러 단어로 되어 있다면 명령 부분을 따옴표로 묶어야 함

 sudo 명령
 - root 또는 다른 사용자가 되어 명령을 실행하기 위한 명령
  특정 사용자나 그룹별로 세세한 권한 부여 가능
  본인의 암호만 필요하며, root계정의 암호를 요구하지 않음
  단 관리자가 /etc/sudoers 파일에서는 누가 어디서 어떤 명령을 수행가능한지 권한설정해야함
 - sudo [-u username] command
  현재 셸에서 수행되므로 명령어 부분에 따옴표 필요 X
  u 옵션 사용하면 root사용자가 아닌 특정사용자로 수행
  sudo -|은 자신에게 sudo를 통해 허용된 명령 확인 가능

 /etc/sudoers 파일
 - root 사용자가 visudo를 사용하여 편집
 - 기본 문법은 user MACHINE=COMMANDS 의 형태

2. 사용자 계정 만들기
 useradd 명령
  - 사용자 계정 만드는 관리자 명령
  - useradd [option] username
   useradd -c "사용자명" 사용자명은 사용자명이라는 계정을 만듬
   -c는 계정설명을 주기위한것
   passwd [username]명령으로 비밀번호설정할수있음
  - useradd -D [option]
   useradd -D 명령은 계정생성시 사용되는 홈디렉터리, 주그룹, 만료일, 기본셸등에 관한 기본설정을 보여줌
   다른 옵션과 함께 사용되며 기본설정변경가능
  - d home_dir
  - D [option]
  - e expire_date
  - g group
  - G group_list
  - s shell : 사용자 기본 셸 설정
  - u user_id : 사용자 UID 수동 설정

 사용자 계정의 생성 절차
  - /etc/login.defs 파일과 /etc/default/useradd 파일을 읽어서 사용자 계정생성과 관련된 기본값 확인
  - useradd 명령어에서 주어진옵션 검사하고 기본값 대체할것인지 확인
  - /etc/passwd 파일과 /etc/shadow 파일에 새로운 사용자 계정에 해당하는 항목 생성
  - /etc/group 파일에 새로운 그룹에 해당하는 항목 추가
  - /home/username을 생성
  - /etc/skel/ 디렉터리에 있는 파일을 사용자 계정의 홈 디렉터리에 복사

 /etc/shadow 파일
  - 사용자 계정의 암호정보와 '패스워드 에이징 ' 정보를 가짐
  - 각 라인은 아래와 같은 라인을 가짐
   kdhong:$6$w8j<중간생략>:19585:0:100:7:10:19722:
  - 필드의 의미
   사용자 계정 : 암호화된 비밀번호: 최종비밀번호변경일:
   0 은 비밀번호 변경 후 바꿀 수 없는 기간
   100 은 비밀번호 변경 후 다시 변경하지 않고 사용할 수 있는 기간
   7은 비밀번호 만료일 전에 경고를 보내는 날짜 수
   10은 비밀번호 만료 후 로그인 가능한 날짜 수
   사용자 계정의 만료일로 빈 값은 계정이 만료되지 않는다는 것
   예약 필드

 change 명령
 - 사용자의 비밀번호 만료에 관한 정보를 변경하는 관리자 명령
 - change [options] username
  change -| username으로 계정의 패스워드 에이징 정보를 확인함
 - 옵션
  -| days는 비밀번호 만료 후 비활성화가 되기 전까지의 날짜 수(-1은 사용하지 않음)
  -m days와 -M days는 각각 비밀번호의 최소와 최대 사용 날짜 수
  -d date는 비밀번호의 마지막 변경 날짜를 수정
  -E date는 사용자계정의 만료일을 지정(-1은 사용하지 않음)

 사용자 계정의 기본 설정
 - 사용자 계정을 생성할 때 필요한 기본값을 정의한 파일 : /etc/login.defs
  각 라인은 키워드와 값으로 구성
  UID_MIN과 UID_MAX는 UID 자동 할당 시 유효범위 지정
  USERGROUPS_ENAB은 사용자 계정과 같은 이름의 그룹을 자동으로 만들 지 지정
 - useradd 명령이 참조하는 기본값을 설정한 파일 : /ect/default/useradd
  GROUP은 자동 생성을 안할 때 사용자 계정의 주 그룹 지정
  홈 디렉터리의 생성 위치와 셸종류 지정
  INACTIVE가 0이면 비밀번호 만료 후 즉시 계정 비활성화, -1이면 기능 사용 X
  EXPIRE값이 없으면 계정만료일 X

3. 사용자 계정 수정
 usermod 명령
 - 사용자 계정 정보 수정하는 명령
 - usermod [option] username
  많은 옵션이 useradd 명령과 유사
  usermod -g root 사용자명은 주어진 사용자의 주 그룹을 root그룹으로 변경
  id username 명령은 주어진 사용자의 uid와 gid 정보 출력

 옵션
 -d home_dir 사용자 홈 디렉터리 변경
 -m
 -l login_name
 -g group
 -L
 -U

 userdel 명령
 - 사용자 계정 삭제하는 관리자명령
 - /etc/passwd 파일에서 해당 라인 삭제
 - userdel [option] username
 - 옵션
  -r은 홈 디렉터리와 파일을 함께 삭제하고 메일스풀도 삭제
  -f는 로그인중이거나 다른사용자가 사용중이어도 삭제, 같은그룹이름도 삭제

 사용자 계정 삭제 시 고려사항
 - 홈 디렉터리도 삭제?
 - 계정 삭제 or 잠금?
 - 삭제될 계정이 소유하는 파일이 또 있는가?
  삭제 전 : find/ -user username -ls 로 확인
  삭제 후 : fund/ -uid UID -ls 또는 find/ -nouser -ls 로 확인

4. 그룹 계정과 관리
 그룹 계정
 - 사용자의 계정을 모아서 하나의 집합을 이루는 개념
  그룹 구성원은 특정파일(디렉터리)에 대해 그룹에 부여된 권한 가짐
  일반 사용자는 bin, mail, sys등 '시스템 그룹 계정' 에는 포함X
  사용자 계정을 만들 때 주 그룹(기본 그룹)이 지정됨
  사용자 계정은 0개 이상의 부 그룹에 속할 수 있음

 groupadd 명령
 - 그룹 계정을 만드는 관리자 명령
 - groupadd [option] group
 - 옵션
  -g gid는 수동으로 GID 지정
  -r은 시스템 그룹 계정 생성
  -o는 -g 옵션과 함께 사용할 때 기존 그룹의 GID를 사용

 /etc/group파일
 - 그룹 계정의 정보를 가진 텍스트 파일
 - 각 라인은 콜론(:)으로 구분된 4개의 필드를 가짐
  그룹이름:그룹비번:GID:구성원리스트
 - 암호화된 비밀번호는 /etc/gshadow에 저장
 - 사용자의 부 그룹 추가 방법
  usermod -G groups -a 유저명
 - 사용자가 자신의 그룹 확인하는 방법
  id 유저명
  groups 유저명

 사용자 계정과 그룹 및 파일의 접근권한
 - 사용자가 파일이나 디렉터리를 생성하면 그것의 소유 그룹은 사용자의 주 그룹으로 지정
 - 사용자는 0개 이상의 부 그룹에 속할 수 있음
 - 사용자 스스로 다른 그룹의 구성원이 되게 할 수는 없음
 - newgrp group을 실행하면 일시적으로 자신의 주 그룹 변경 가능
  자신이 속해있는 그룹중에서 지정
  그룹 계정의 비번 알고있다면 다른그룹으로도 지정 가능
  단순히 newgrp을 실행하면 원래 주그룹으로 되돌아감

 gpasswd 명령
 - 그룹관리위한 명령
  그룹관리자가 사용
 - gpasswd [options] group
  옵션 사용하지 않으면 그룹비밀번호 설정
  옵션 사용시 그룹 구성원 변경
 - [option]
  -a user는 구성원 추가, -A users는 그룹관리자 지정
  -d user는 구성원 삭제, -M user는 구성원 설정
  -r은 비밀번호 삭제

 groupmod 명령
 - 기존그룹정보 수정하기 위한 명령
 - groupmod [options] group

 groupdel 명령
 - 그룹삭제하는 관리자 명령
 - groupdel 그룹명

5. 사용자 관리를 위한 GUI
 사용자 관리 도구
 - 데탑메뉴에서 현재활동 > 프로그램 표시 > 설정
 - 설정 창의 왼쪽 메뉴에서 사용자 선택
 - 잠금 해제 버튼을 클릭하고 root 계정의 비밀번호 입력
 - 새로운 사용자를 추가하거나 기존사용자 계정의 등록정보 수정 가능